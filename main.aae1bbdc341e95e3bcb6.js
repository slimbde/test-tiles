!function(t){function e(e){for(var o,s,l=e[0],a=e[1],c=e[2],h=0,d=[];h<l.length;h++)s=l[h],Object.prototype.hasOwnProperty.call(n,s)&&n[s]&&d.push(n[s][0]),n[s]=0;for(o in a)Object.prototype.hasOwnProperty.call(a,o)&&(t[o]=a[o]);for(u&&u(e);d.length;)d.shift()();return r.push.apply(r,c||[]),i()}function i(){for(var t,e=0;e<r.length;e++){for(var i=r[e],o=!0,l=1;l<i.length;l++){var a=i[l];0!==n[a]&&(o=!1)}o&&(r.splice(e--,1),t=s(s.s=i[0]))}return t}var o={},n={0:0},r=[];function s(e){if(o[e])return o[e].exports;var i=o[e]={i:e,l:!1,exports:{}};return t[e].call(i.exports,i,i.exports,s),i.l=!0,i.exports}s.m=t,s.c=o,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)s.d(i,o,function(e){return t[e]}.bind(null,o));return i},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="";var l=window.webpackJsonp=window.webpackJsonp||[],a=l.push.bind(l);l.push=e,l=l.slice();for(var c=0;c<l.length;c++)e(l[c]);var u=a;r.push([126,1]),i()}({126:function(t,e,i){i(127),t.exports=i(318)},313:function(t,e,i){},318:function(t,e,i){"use strict";i.r(e);i(313);var o=i(11),n=i.n(o),r=i(12),s=i.n(r),l=function(){function t(){n()(this,t)}return s()(t,[{key:"render",value:function(){var t=document.getElementById("field");t.style.opacity="0",t.style.display="none",document.querySelector(".game-over").style.opacity="1"}}]),t}(),a=i(5),c=i.n(a),u=i(125),h=i.n(u),d=function(){function t(e,i,o,r){var s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;if(n()(this,t),c()(this,"top",void 0),c()(this,"left",void 0),c()(this,"color",void 0),c()(this,"dead",void 0),s)return this.top=s.top,this.left=s.left,this.color=s.color,void(this.dead=s.dead);this.top=e,this.left=i,this.color=o,this.dead=r}return s()(t,[{key:"clone",value:function(){return new t(this.top,this.left,this.color,this.dead)}}]),t}(),f=function(){function t(){n()(this,t)}return s()(t,[{key:"create",value:function(t){if(t)return t.clone();var e=window.tileColors[Math.floor(window.tileColors.length*Math.random())];return new d(0,0,e,!1)}}]),t}(),v=function(){function t(){n()(this,t),c()(this,"factory",new f)}return s()(t,[{key:"fill",value:function(t){for(var e=[],i=0;i<t.length;++i)e[i]=[];for(var o=0;o<t.length;++o)for(var n=0;n<t[0].length;++n){var r=t[o][n];if(r.dead&&o<t.length){for(var s=r.left,l=o+1;l<t.length;++l){var a=t[l][n];if(!a.dead){var c=this.factory.create(a);c.left=s,e[s][n]=c,a.dead=!0,++s}}for(var u=t.length-1;u>=s;--u)if(!e[u][n]||e[u][n]&&e[u][n].dead){var h=this.factory.create();h.left=u,h.top=n,e[u][n]=h}}else if(r.dead){var d=this.factory.create();d.left=o,d.top=n,e[o][n]=d}else e[o][n]=t[o][n]}return e}}]),t}(),y=function(){function t(){n()(this,t),c()(this,"factory",new f)}return s()(t,[{key:"fill",value:function(t){for(var e=[],i=0;i<t.length;++i)e[i]=[];for(var o=0;o<t.length;++o)for(var n=t[0].length-1;n>=0;--n){var r=t[o][n];if(r.dead&&n>0){for(var s=r.top,l=n-1;l>=0;--l){var a=t[o][l];if(!a.dead){var c=this.factory.create(a);c.top=s,e[o][s]=c,a.dead=!0,--s}}for(var u=0;u<=s;++u)if(!e[o][u]||e[o][u]&&e[o][u].dead){var h=this.factory.create();h.left=o,h.top=u,e[o][u]=h}}else if(r.dead){var d=this.factory.create();d.left=o,d.top=n,e[o][n]=d}else e[o][n]=t[o][n]}return e}}]),t}(),p=function(){function t(e,i){n()(this,t),c()(this,"tileFactory",new f),c()(this,"strategy",void 0),c()(this,"currentColor",void 0),c()(this,"attempts",void 0),c()(this,"goalPoints",void 0),c()(this,"userPoints",void 0),c()(this,"tileSet",void 0),c()(this,"gameStatus",void 0),c()(this,"numShuffles",void 0),this.strategy=new y,this.attempts=window.attempts,this.goalPoints=window.goalPoints,this.userPoints=0,this.gameStatus="playing",this.numShuffles=window.shuffles,this.tileSet=[];for(var o=0;o<e;++o){this.tileSet[o]=[];for(var r=0;r<i;++r){var s=this.tileFactory.create();s.left=o,s.top=r,this.tileSet[o][r]=s}}}return s()(t,[{key:"burn",value:function(t,e){return--this.attempts,this.currentColor=this.tileSet[t][e].color,this.killAdjacent(t,e),this.calculateGameStatus(),this.tileSet}},{key:"fill",value:function(){return this.tileSet=this.strategy.fill(this.tileSet),this.tileSet}},{key:"alterStrategy",value:function(t){switch(t){case"Сверху":this.strategy=new y;break;case"Справа":this.strategy=new v}}},{key:"shuffle",value:function(){for(var t=this.tileSet.reduce((function(t,e){return t.concat.apply(t,h()(e))}),[]),e=t.length-1;e>0;e--){var i=Math.floor(Math.random()*(e+1)),o=[t[i],t[e]];t[e]=o[0],t[i]=o[1]}for(var n=0,r=0;r<this.tileSet.length;++r)for(var s=0;s<this.tileSet[0].length;++s)this.tileSet[r][s]=t[n],t[n].left=r,t[n].top=s,++n;return--this.numShuffles,this.tileSet}},{key:"killAdjacent",value:function(t,e){this.tileSet[t][e].dead=!0,this.userPoints+=100,this.tryKill(t,e-1),this.tryKill(t,e+1),this.tryKill(t+1,e),this.tryKill(t-1,e)}},{key:"tryKill",value:function(t,e){if(this.validPoint(t,e)){var i=this.tileSet[t][e];if(i.dead)return;i.color===this.currentColor&&(i.dead=!0,this.killAdjacent(i.left,i.top))}}},{key:"validPoint",value:function(t,e){return t<this.tileSet.length&&t>=0&&e>=0&&e<this.tileSet[0].length}},{key:"calculateGameStatus",value:function(){this.attempts>0?this.userPoints>=this.goalPoints&&(this.gameStatus="victory"):this.userPoints>=this.goalPoints?this.gameStatus="victory":this.gameStatus="game-over"}}]),t}(),g=function(){function t(){var e=this;n()(this,t),c()(this,"engine",void 0),c()(this,"tileSet",void 0),c()(this,"root",void 0),c()(this,"rootWidth",void 0),c()(this,"rootHeight",void 0),c()(this,"scores",void 0),document.querySelector(".game-over").style.opacity="0",document.querySelector(".victory").style.opacity="0",this.scores=document.querySelector(".scores"),this.scores.classList.remove("good-scores"),this.scores.classList.remove("fail-scores"),this.rootWidth=parseInt(document.getElementById("width").value),this.rootHeight=parseInt(document.getElementById("height").value),this.root=document.getElementById("field"),this.root.style.width="calc(".concat(this.rootWidth,"px * ").concat(window.tileSize," + 2rem + 2px)"),this.root.style.height="calc(".concat(this.rootHeight,"px * ").concat(window.tileSize," + 2rem + 2px)"),this.root.style.opacity="0",setTimeout((function(t){e.root.style.opacity="1",e.root.style.display="flex"}),500);var i=document.getElementById("strategy");i.onchange=function(t){return e.engine.alterStrategy(t.target.value)},i.style.cursor="pointer",this.engine=new p(this.rootWidth,this.rootHeight),this.engine.alterStrategy(i.value),this.tileSet=this.engine.tileSet;var o=document.getElementById("shuffle");!o&&(o=document.createElement("button")),o.style.display="flex",o.id="shuffle",o.className="btn",o.textContent="Перемешать: ".concat(this.engine.numShuffles),o.onclick=function(t){e.tileSet=e.engine.shuffle(),o.textContent="Перемешать: ".concat(e.engine.numShuffles),0==e.engine.numShuffles&&(o.style.display="none"),e.render()},document.querySelector(".menu").appendChild(o)}return s()(t,[{key:"render",value:function(){var t=this;this.scores.innerHTML="Попыток: ".concat(this.engine.attempts,"&nbsp;&nbsp;&nbsp; Очки: ").concat(this.engine.userPoints," &nbsp;&nbsp;&nbsp; Необходимо набрать: ").concat(this.engine.goalPoints),this.root.style.opacity="1",this.root.innerHTML="";for(var e=function(e){for(var i=function(i){var o=t.tileSet[e][i],n=document.createElement("div");n.className="tile",n.style.width=window.tileSize+"px",n.style.height=window.tileSize+"px",n.style.backgroundColor=o.color,o.dead&&n.classList.add("dead-tile"),n.onclick=function(o){t.tileSet=t.engine.burn(e,i),setTimeout((function(e){t.render(),t.tileSet=t.engine.fill(),setTimeout((function(e){return"victory"===t.engine.gameStatus?(t.scores.classList.add("good-scores"),void window.render("victory")):"game-over"===t.engine.gameStatus?(t.scores.classList.add("fail-scores"),void window.render("game-over")):void t.render()}),1e3)}),100)},n.style.left=e*window.tileSize+15+"px",n.style.top=i*window.tileSize+15+"px",t.root.appendChild(n)},o=0;o<t.rootHeight;++o)i(o)},i=0;i<this.rootWidth;++i)e(i)}}]),t}(),m=function(){function t(){n()(this,t)}return s()(t,[{key:"render",value:function(){var t=document.getElementById("field");t.style.opacity="0",setTimeout((function(e){return t.style.display="none"})),document.querySelector(".victory").style.opacity="1"}}]),t}();window.render=function(t){switch(t){case"home":window.ctor=new g;break;case"game-over":window.ctor=new l;break;case"victory":window.ctor=new m;break;default:throw new Error("Can't find apt constructor")}window.ctor.render()},window.render("home")}});